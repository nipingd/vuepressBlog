(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{578:function(t,e,s){t.exports=s.p+"assets/img/1567322286020.6722c83a.png"},579:function(t,e,s){t.exports=s.p+"assets/img/1567323294510.2935c598.png"},580:function(t,e,s){t.exports=s.p+"assets/img/1567323325233.a9896957.png"},581:function(t,e,s){t.exports=s.p+"assets/img/1567324124947.ad326f04.png"},582:function(t,e,s){t.exports=s.p+"assets/img/1571403451921.dd1c2644.png"},583:function(t,e,s){t.exports=s.p+"assets/img/1571403494518.32262866.png"},584:function(t,e,s){t.exports=s.p+"assets/img/1571404257629.6dd3b032.png"},585:function(t,e,s){t.exports=s.p+"assets/img/1571404652652.fafdd293.png"},586:function(t,e,s){t.exports=s.p+"assets/img/1571404712207.616a3dd9.png"},587:function(t,e,s){t.exports=s.p+"assets/img/1571404976058.5a10e31c.png"},588:function(t,e,s){t.exports=s.p+"assets/img/1571405053659.b6a978cb.png"},589:function(t,e,s){t.exports=s.p+"assets/img/1571405290280.cbed0b70.png"},590:function(t,e,s){t.exports=s.p+"assets/img/1571405393764.3be50a4f.png"},591:function(t,e,s){t.exports=s.p+"assets/img/1571405421262.c4448a64.png"},592:function(t,e,s){t.exports=s.p+"assets/img/1571405464533.2a3de569.png"},593:function(t,e,s){t.exports=s.p+"assets/img/1571405494719.9fb7a5c6.png"},594:function(t,e,s){t.exports=s.p+"assets/img/1571405852949.21b754ef.png"},595:function(t,e,s){t.exports=s.p+"assets/img/1571405868467.5eac2034.png"},717:function(t,e,s){"use strict";s.r(e);var r=[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器是如何渲染ui的？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器是如何渲染ui的？","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器是如何渲染UI的？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[t._v("浏览器获取HTML文件，然后对文件进行解析，形成DOM Tree")]),t._v(" "),s("li",[t._v("与此同时，进行CSS解析，生成Style Rules")]),t._v(" "),s("li",[t._v("接着将DOM Tree与Style Rules合成为 Render Tree")]),t._v(" "),s("li",[t._v("接着进入布局（Layout）阶段，也就是为每个节点分配一个应出现在屏幕上的确切坐标")]),t._v(" "),s("li",[t._v("随后调用GPU进行绘制（Paint），遍历Render Tree的节点，并将元素呈现出来")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(578),alt:"1567322286020"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器如何解析css选择器？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器如何解析css选择器？","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器如何解析css选择器？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("我们知道DOM Tree与Style Rules合成为 Render Tree，实际上是需要将"),e("em",[this._v("Style Rules")]),this._v("附着到DOM Tree上，因此需要根据选择器提供的信息对DOM Tree进行遍历，才能将样式附着到对应的DOM元素上。")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-css line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v(".mod-nav h3 span")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("font-size")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 16px"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(579),alt:"1567323294510"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("从 .mod-nav 开始，遍历子节点 header 和子节点 div")]),this._v(" "),e("li",[this._v("然后各自向子节点遍历。在右侧 div 的分支中")]),this._v(" "),e("li",[this._v("最后遍历到叶子节点 a ，发现不符合规则，需要回溯到 ul 节点，再遍历下一个 li-a，一颗DOM树的节点动不动上千，这种效率很低。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ol",[e("li",[this._v("先找到所有的最右节点 span，对于每一个 span，向上寻找节点 h3")]),this._v(" "),e("li",[this._v("由 h3再向上寻找 class=mod-nav 的节点")]),this._v(" "),e("li",[this._v("最后找到根元素 html 则结束这个分支的遍历。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"dom-tree是如何构建的？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dom-tree是如何构建的？","aria-hidden":"true"}},[this._v("#")]),this._v(" DOM Tree是如何构建的？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ol",[s("li",[s("strong",[t._v("转码")]),t._v(": 浏览器将接收到的二进制数据按照指定编码格式转化为HTML字符串")]),t._v(" "),s("li",[s("strong",[t._v("生成Tokens")]),t._v(": 之后开始parser，浏览器会将HTML字符串解析成Tokens")]),t._v(" "),s("li",[s("strong",[t._v("构建Nodes")]),t._v(": 对Node添加特定的属性，通过指针确定 Node 的父、子、兄弟关系和所属 treeScope")]),t._v(" "),s("li",[s("strong",[t._v("生成DOM Tree")]),t._v(": 通过node包含的指针确定的关系构建出DOM Tree")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(580),alt:"1567323325233"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器重绘与重排的区别？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器重绘与重排的区别？","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器重绘与重排的区别？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("重排: "),e("strong",[this._v("部分渲染树（或者整个渲染树）需要重新分析并且节点尺寸需要重新计算")]),this._v("，表现为重新生成布局，重新排列元素")]),this._v(" "),e("li",[this._v("重绘: "),e("strong",[this._v("由于节点的几何属性发生改变或者由于样式发生改变")]),this._v("，例如改变元素背景色时，屏幕上的部分内容需要更新，表现为某些元素的外观被改变")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("『重绘』不一定会出现『重排』，『重排』必然会出现『重绘』。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"如何触发重排和重绘？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何触发重排和重绘？","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何触发重排和重绘？")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("添加、删除、更新DOM节点")]),t._v(" "),s("li",[t._v("通过display: none隐藏一个DOM节点-触发重排和重绘")]),t._v(" "),s("li",[t._v("通过visibility: hidden隐藏一个DOM节点-只触发重绘，因为没有几何变化")]),t._v(" "),s("li",[t._v("移动或者给页面中的DOM节点添加动画")]),t._v(" "),s("li",[t._v("添加一个样式表，调整样式属性")]),t._v(" "),s("li",[t._v("用户行为，例如调整窗口大小，改变字号，或者滚动。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"如何避免重绘或者重排？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#如何避免重绘或者重排？","aria-hidden":"true"}},[this._v("#")]),this._v(" 如何避免重绘或者重排？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"集中改变样式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#集中改变样式","aria-hidden":"true"}},[this._v("#")]),this._v(" 集中改变样式")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 判断是否是黑色系样式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" theme "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" isDark "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dark'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'light'")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 根据判断来设置不同的class")]),t._v("\nele"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setAttribute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'className'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" theme"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"使用documentfragment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用documentfragment","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用DocumentFragment")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" fragment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDocumentFragment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" node "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"p"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  fragment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("node"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ndocument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fragment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"提升为合成层"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#提升为合成层","aria-hidden":"true"}},[this._v("#")]),this._v(" 提升为合成层")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("合成层的位图，会交由 GPU 合成，比 CPU 处理要快")]),this._v(" "),e("li",[this._v("当需要 repaint 时，只需要 repaint 本身，不会影响到其他的层")]),this._v(" "),e("li",[this._v("对于 transform 和 opacity 效果，不会触发 layout 和 paint")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"language-css line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-css"}},[s("code",[s("span",{pre:!0,attrs:{class:"token selector"}},[t._v("#target")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token property"}},[t._v("will-change")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" transform"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"前端如何实现即时通讯？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前端如何实现即时通讯？","aria-hidden":"true"}},[this._v("#")]),this._v(" 前端如何实现即时通讯？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"短轮询"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#短轮询","aria-hidden":"true"}},[this._v("#")]),this._v(" 短轮询")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("优点：兼容性强，实现非常简单")]),this._v(" "),e("li",[this._v("缺点：延迟性高，非常消耗请求资源，影响性能")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"comet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#comet","aria-hidden":"true"}},[this._v("#")]),this._v(" comet")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("优点：兼容性好，资源浪费较小")]),this._v(" "),e("li",[this._v("缺点：服务器hold连接会消耗资源，返回数据顺序无保证，难于管理维护")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("优点：兼容性好，消息即时到达，不发无用请求")]),this._v(" "),e("li",[this._v("缺点：服务器维护长连接消耗资源")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"sse"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sse","aria-hidden":"true"}},[this._v("#")]),this._v(" SSE")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("优点：基于HTTP而生，因此不需要太多改造就能使用，使用方便，而websocket非常复杂，必须借助成熟的库或框架")]),this._v(" "),e("li",[this._v("缺点：基于文本传输效率没有websocket高，不是严格的双向通信，客户端向服务端发送请求无法复用之前的连接，需要重新发出独立的请求")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"websocket"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#websocket","aria-hidden":"true"}},[this._v("#")]),this._v(" Websocket")])},function(){var t=this.$createElement,e=this._self._c||t;return e("ul",[e("li",[this._v("优点：真正意义上的实时双向通信，性能好，低延迟")]),this._v(" "),e("li",[this._v("缺点：独立与http的协议，因此需要额外的项目改造，使用复杂度高，必须引入成熟的库，无法兼容低版本浏览器")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(581),alt:"1567324124947"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"web-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#web-worker","aria-hidden":"true"}},[this._v("#")]),this._v(" Web Worker")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("后面性能优化部分会用到，先做了解")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"service-workers"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-workers","aria-hidden":"true"}},[this._v("#")]),this._v(" Service workers")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("后面性能优化部分会用到，先做了解")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器架构-chrome为例子"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器架构-chrome为例子","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器架构(chrome为例子)")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(582),alt:"1571403451921"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[s("strong",[t._v("浏览器进程")]),t._v("：控制浏览器这个应用的chrome（主框架）部分，包括地址栏、书签、前进/后退按钮等，同时也会处理浏览器不可见的高权限任务，如发送网络请求、访问文件。")]),t._v(" "),s("li",[s("strong",[t._v("渲染器进程")]),t._v("：负责在标签页中显示网站及处理事件。")]),t._v(" "),s("li",[s("strong",[t._v("插件进程")]),t._v("：控制网站用到的所有插件。")]),t._v(" "),s("li",[s("strong",[t._v("GPU进程")]),t._v("：在独立的进程中处理GPU任务。之所以放到独立的进程，是因为GPU要处理来自多个应用的请求，但要在同一个界面上绘制图形。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(583),alt:"1571403494518"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("Chrome架构进化的目标是将整个浏览器程序的不同部分服务化，便于分割或合并。基本思路是"),e("strong",[this._v("在高配设备中，每个服务独立开进程，保证稳定；在低配设备中，多个服务合并为一个进程，节约资源")]),this._v("。同样的思路也应用到了Android上。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器导航"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器导航","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器导航")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(584),alt:"1571404257629"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("第一步："),e("strong",[this._v("处理输入")]),this._v("。UI线程会判断用户输入的是查询字符串还是URL。因为Chrome的地址栏同时也是搜索框。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(585),alt:"1571404652652"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("第二步："),e("strong",[this._v("开始导航")]),this._v("。如果输入的是URL，UI线程会通知网络线程发起网络调用，获取网站内容。此时标签页左端显示旋转图标，网络线程进行DNS查询、建立TLS连接（对于HTTPS）。网络线程可能收到服务器的重定向头部，如HTTP 301。此时网络线程会跟UI线程沟通，告诉它服务器要求重定向。然后，再发起对另一个URL的请求。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(586),alt:"1571404712207"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("第三步："),e("strong",[this._v("读取响应")]),this._v("。服务器返回的响应体到来之后，网络线程会检查接收到的前几个字节。响应的Content-Type头部应该包含数据类型，如果没有这个字段，则需要MIME类型嗅探（http://t.cn/Rt2gG2J）。看看Chrome源码（http://t.cn/Ai9cZI7D）中的注释就知道这一块有多难搞。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(587),alt:"1571404976058"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("第四步："),e("strong",[this._v("联系渲染器进程")]),this._v("。所有查检完毕，网络线程确认浏览器可以导航到用户请求的网站，于是会通知UI线程数据已经准备好了。UI线程会联系渲染器进程渲染网页。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(588),alt:"1571405053659"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("由于网络请求可能要花几百毫秒才能拿到响应，这里还会应用一个优化策略。第二步UI线程要求网络线程发送请求后，已经知道可能要导航到哪个网站去了。因此在发送网络请求的同时，UI线程会提前联系或并行启动一个渲染器进程。这样在网络线程收到数据后，就已经有渲染器进程原地待命了。如果发生了重定向，这个待命进程可能用不上，而是换作其他进程去处理")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("第五步："),e("strong",[this._v("提交导航")]),this._v("。数据和渲染器进程都有了，就可以通过IPC从浏览器进程向渲染器进程提交导航。渲染器进程也会同时接收到不间断的HTML数据流。当浏览器进程收到渲染器进程的确认消息后，导航完成，文档加载阶段开始。 "),e("img",{attrs:{src:s(589),alt:"1571405290280"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("最后一步："),e("strong",[this._v("初始加载完成")]),this._v("。提交导航之后，渲染器进程将负责加载资源和渲染页面（具体细节后面介绍）。而在“完成”渲染后（在所有iframe中的onload事件触发且执行完成后），渲染器进程会通过IPC给浏览器进程发送一个消息。此时，UI线程停止标签页上的旋转图标。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("blockquote",[e("p",[this._v("初始加载完成后，客户端JavaScript仍然可能加载额外资源并重新渲染页面。")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(590),alt:"1571405393764"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(591),alt:"1571405421262"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(592),alt:"1571405464533"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(593),alt:"1571405494719"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"浏览器渲染"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染","aria-hidden":"true"}},[this._v("#")]),this._v(" 浏览器渲染")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(594),alt:"1571405852949"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"解析html"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#解析html","aria-hidden":"true"}},[this._v("#")]),this._v(" 解析HTML")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("构建DOM")]),this._v("。渲染器进程收到导航的提交消息后，开始接收HTML，其主线程开始解析文本字符串（HTML），并将它转换为DOM（Document Object Model，文档对象模型）。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("加载子资源")]),this._v("。网站都会用到图片、CSS和JavaScript等外部资源。浏览器需要从缓存或网络加载这些文件。主线程可以在解析并构建DOM的过程中发现一个加载一个，但这样效率太低。为此，Chrome会在解析同时并发运行“预加载扫描器”，当发现HTML文档中有"),e("img"),this._v("或"),e("link"),this._v("时，预加载扫描器会将请求提交给浏览器进程中的网络线程。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("img",{attrs:{src:s(595),alt:"1571405868467"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("strong",[this._v("JavaScript可能阻塞解析")]),this._v("。如果HTML解析器碰到"),e("script")])}],n=s(0),a=Object(n.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[s("p",[t._v("以下转载自："),s("a",{attrs:{href:"https://www.cxymsg.com/guide/browser.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.cxymsg.com/guide/browser.html"),s("OutboundLink")],1)]),t._v(" "),t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("浏览器会『从右往左』解析CSS选择器。")]),t._v(" "),t._m(4),t._v(" "),s("p",[t._v("以下这段css为例")]),t._v(" "),t._m(5),s("p",[t._v("我们对应的DOM Tree 如下")]),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("若从左向右的匹配，过程是：")]),t._v(" "),t._m(7),t._v(" "),s("p",[t._v("如果从右至左的匹配：")]),t._v(" "),t._m(8),t._v(" "),s("p",[t._v("后者匹配性能更好，是因为从右向左的匹配在第一步就筛选掉了大量的不符合条件的最右节点（叶子节点）；而从左向右的匹配规则的性能都浪费在了失败的查找上面。")]),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),s("p",[t._v("单单改变元素的外观，肯定不会引起网页重新生成布局，但当浏览器完成重排之后，将会重新绘制受到此次重排影响的部分")]),t._v(" "),s("p",[t._v("重排和重绘代价是高昂的，它们会破坏用户体验，并且让UI展示非常迟缓，而相比之下重排的性能影响更大，在两者无法避免的情况下，一般我们宁可选择代价更小的重绘。")]),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),s("p",[t._v("任何改变用来构建渲染树的信息都会导致一次重排或重绘：")]),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),s("p",[t._v("我们往往通过改变class的方式来集中改变样式")]),t._v(" "),t._m(19),t._m(20),t._v(" "),s("p",[t._v("我们可以通过createDocumentFragment创建一个游离于DOM树之外的节点，然后在此节点上批量操作，最后插入DOM树中，因此只触发一次重排")]),t._v(" "),t._m(21),t._m(22),t._v(" "),s("p",[t._v("将元素提升为合成层有以下优点：")]),t._v(" "),t._m(23),t._v(" "),s("p",[t._v("提升合成层的最好方式是使用 CSS 的 will-change 属性：")]),t._v(" "),t._m(24),s("blockquote",[s("p",[t._v("关于合成层的详解请移步"),s("a",{attrs:{href:"https://fed.taobao.org/blog/2016/04/26/performance-composite/",target:"_blank",rel:"noopener noreferrer"}},[t._v("无线性能优化：Composite"),s("OutboundLink")],1)])]),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),s("p",[t._v("短轮询的原理很简单，每隔一段时间客户端就发出一个请求，去获取服务器最新的数据，一定程度上模拟实现了即时通讯。")]),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),s("p",[t._v("comet有两种主要实现手段，一种是基于 AJAX 的长轮询（long-polling）方式，另一种是基于 Iframe 及 htmlfile 的流（streaming）方式，通常被叫做长连接。")]),t._v(" "),s("blockquote",[s("p",[t._v("具体两种手段的操作方法请移步"),s("a",{attrs:{href:"http://www.52im.net/thread-334-1-1.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Comet技术详解：基于HTTP长连接的Web端实时通信技术"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("长轮询优缺点：")]),t._v(" "),t._m(29),t._v(" "),s("p",[t._v("长连接优缺点：")]),t._v(" "),t._m(30),t._v(" "),t._m(31),t._v(" "),s("blockquote",[s("p",[t._v("使用指南请看"),s("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Server-Sent Events 教程"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("😋**SSE（Server-Sent Event，服务端推送事件）**是一种允许服务端向客户端推送新数据的HTML5技术。")]),t._v(" "),t._m(32),t._v(" "),t._m(33),t._v(" "),s("blockquote",[s("p",[t._v("使用指南请看"),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2017/05/websocket.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("WebSocket 教程"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("Websocket是一个全新的、独立的协议，基于TCP协议，与http协议兼容、却不会融入http协议，仅仅作为html5的一部分，其作用就是在服务器和客户端之间建立实时的双向通信。")]),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),s("p",[t._v("Web Worker 的作用，就是为 JavaScript 创造多线程环境，允许主线程创建 Worker 线程，将一些任务分配给后者运行")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2018/07/web-worker.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Web Worker教程"),s("OutboundLink")],1)])]),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),s("p",[t._v("Service workers 本质上充当Web应用程序与浏览器之间的代理服务器，也可以在网络可用时作为浏览器和网络间的代理，创建有效的离线体验。")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API",target:"_blank",rel:"noopener noreferrer"}},[t._v("Service workers教程"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("以下文章来源于奇舞周刊 ，作者李松峰")]),t._v(" "),t._m(40),t._v(" "),s("p",[t._v("Web浏览器的架构，可以实现为一个进程包含多个线程，也可以实现为很多进程包含少数线程通过IPC通信。如何实现浏览器，并没有统一的标准。Chrome最新的架构：最上层是浏览器进程，负责协调承担各项工作的其他进程，比如实用程序进程、渲染器进程、GPU进程、插件进程等，如下图所示。")]),t._v(" "),t._m(41),t._v(" "),s("p",[t._v("渲染器进程对应新开的标签页，每新开一个标签页，就会创建一个新的渲染器进程。不仅如此，Chrome还会尽量给每个站点新开一个渲染器进程，包括iframe中的站点，以实现站点隔离。")]),t._v(" "),s("p",[t._v("下面详细了解一下每个进程的作用，可以参考下图。")]),t._v(" "),t._m(42),t._v(" "),t._m(43),t._v(" "),s("p",[t._v("当然，还有其他进程，比如扩展进程、实用程序进程。要知道你的Chrome当前打开了多少个进程，点击右上角的按钮，选择“更多工具”，再选择“任务管理器”。")]),t._v(" "),s("p",[t._v("Chrome的多进程架构有哪些优点呢？")]),t._v(" "),s("p",[t._v("最简单的情况下，可以想像一个标签页就是一个渲染器进程，比如3个标签页就是3个渲染器进程。这时候，如果有一个渲染器崩溃了，只要把它关掉即可，不会影响其他标签页。如果所有标签页都运行在一个进程中，那只要有一个标签页卡住，所有标签页都会卡住。")]),t._v(" "),s("p",[t._v("除此之外，多进程架构还有助于安全和隔离。因为操作系统有限制进程特权的机制，浏览器可以借此限制某些进程的能力。比如，Chrome会限制处理任意用户输入的渲染器进程，不让它任意访问文件。")]),t._v(" "),s("p",[t._v("由于进程都有自己私有的内存空间，因此每个进程可能都会保存某个公共基础设施（比如Chrome的JavaScript引擎V8）的多个副本。这会导致内存占用增多。为节省内存，Chrome会限制自己可以打开的进程数量。限制的条件取决于设备内存和CPU配置。达到限制条件后，Chrome会用一个进程处理同一个站点的多个标签页。")]),t._v(" "),t._m(44),t._v(" "),s("p",[t._v("重点说一说站点隔离（http://t.cn/RgNAwLC）。站点隔离是新近引入Chrome的一个里程碑式特性，即每个跨站点iframe都运行一个独立的渲染器进程。即便像前面说的那样，每个标签页单开一个渲染器进程，但允许跨站点的iframe运行在同一个渲染器进程中并共享内存空间，那安全攻击仍然有可能绕开同源策略（http://t.cn/8s1ySzx），而且有人发现在现代CPU中，进程有可能读取任意内存（http://t.cn/R8FwHoX）。")]),t._v(" "),s("p",[t._v("进程隔离是隔离站点、确保上网安全最有效的方式。Chrome 67桌面版默认采用站点隔离。站点隔离是多年工程化努力的结果，它并非多开几个渲染器进程那么简单。比如，不同的iframe运行在不同进程中，开发工具在后台仍然要做到无缝切换，而且即便简单地Ctrl+F查找也会涉及在不同进程中搜索。")]),t._v(" "),t._m(45),t._v(" "),s("p",[t._v("导航涉及浏览器进程与线程间为显示网页而通信。一切从用户在浏览器中输入一个URL开始。输入URL之后，浏览器会通过互联网获取数据并显示网页。从请求网页到浏览器准备渲染网页的过程，叫做导航。")]),t._v(" "),s("p",[t._v("如前所述，标签页外面的一切都由浏览器进程处理。浏览器进程中有线程（UI线程）负责绘制浏览器的按钮和地址栏，有线程（网络线程）负责处理网络请求并从互联网接收数据，有线程（存储线程）负责访问文件和存储数据。")]),t._v(" "),t._m(46),t._v(" "),s("p",[t._v("下面我们逐步看一看导航的几个步骤。")]),t._v(" "),t._m(47),t._v(" "),t._m(48),t._v(" "),t._m(49),t._v(" "),t._m(50),t._v(" "),t._m(51),t._v(" "),t._m(52),t._v(" "),t._m(53),t._v(" "),t._m(54),t._v(" "),t._m(55),t._v(" "),t._m(56),t._v(" "),s("p",[t._v("此时，地址栏会更新，安全指示图标和网站设置UI也会反映新页面的信息。当前标签页面的会话历史会更新，后退/前进按钮起作用。为便于标签页/会话在关闭标签页或窗口后恢复，会话历史会写入磁盘。")]),t._v(" "),t._m(57),t._v(" "),t._m(58),t._v(" "),s("p",[t._v("如果此时用户在地址又输入了其他URL呢？浏览器进程还会重复上述步骤，导航到新站点。不过在此之前，需要确认已渲染的网站是否关注beforeunload事件。因为标签页中的一切，包括JavaScript代码都由渲染器进程处理，所以浏览器进程必须与当前的渲染器进程确认后再导航到新站点。")]),t._v(" "),t._m(59),t._v(" "),s("p",[t._v('如果导航请求来自当前渲染器进程（用户点击了链接或JavaScript运行了window.location = "https://newsite.com"），渲染器进程首先会检查beforeunload处理程序。然后，它会走一遍与浏览器进程触发导航同样的过程。唯一的区别在于导航请求是由渲染器进程提交给浏览器进程的。')]),t._v(" "),s("p",[t._v("导航到不同的网站时，会有一个新的独立渲染器进程负责处理新导航，而老的渲染器进程要负责处理unload之类的事件。更多细节，可以参考“页面生命周期API”：http://t.cn/Rey7RIE。")]),t._v(" "),t._m(60),t._v(" "),s("p",[t._v("另外，导航阶段还可能涉及Service Worker，即网页应用中的网络代理服务（http://t.cn/R3SH3HL），开发者可以通过它控制什么缓存在本地，何时从网络获取新数据。Service Worker说到底也是需要渲染器进程运行的JavaScript代码。如果网站注册了Server Worker，那么导航请求到来时，网络线程会根据URL将其匹配出来，此时UI线程就会联系一个渲染器进程来执行Service Worker的代码：可能只要从本地缓存读取数据，也可能需要发送网络请求。")]),t._v(" "),t._m(61),t._v(" "),s("p",[t._v("如果Service Worker最终决定从网络请求数据，浏览器进程与渲染器进程间的这种往返通信会导致延迟。因此，这里会有一个“导航预加载”的优化（http://t.cn/Ai9qGJ66），即在Service Worker启动同时预先加载资源，加载请求通过HTTP头部与服务器沟通，服务器决定是否完全更新内容。")]),t._v(" "),t._m(62),t._v(" "),t._m(63),t._v(" "),s("p",[t._v("渲染是渲染器进程内部的工作，涉及Web性能的诸多方面（详细内容可以参考这里http://t.cn/Ai9c4nUu）。标签页中的一切都由渲染器进程负责处理，其中主线程负责运行大多数客户端JavaScript代码，少量代码可能会由工作线程处理（如果用到了Web Worker或Service Worker）。合成器（compositor）线程和栅格化（raster）线程负责高效、平滑地渲染页面。")]),t._v(" "),t._m(64),t._v(" "),s("p",[t._v("渲染器进程的核心任务是把HTML、CSS和JavaScript转换成用户可以交互的网页接下来，我们从整体上过一遍渲染器进程处理Web内容的各个阶段。")]),t._v(" "),t._m(65),t._v(" "),t._m(66),t._v(" "),s("p",[t._v("DOM是浏览器内部对页面的表示，也是JavaScript与之交互的数据结构和API。")]),t._v(" "),s("p",[t._v("如何将HTML解析为DOM由HTML标准（http://t.cn/R2NREUt）定义。HTML标准要求浏览器兼容错误的HTML写法，因此浏览器会“忍气吞声”，绝不报错。详情可以看看“解析器错误处理及怪异情形简介”（http://t.cn/Ai9c8i5D）。")]),t._v(" "),t._m(67),t._v(" "),t._m(68),t._v(" "),t._m(69)])},r,!1,null,null,null);e.default=a.exports}}]);