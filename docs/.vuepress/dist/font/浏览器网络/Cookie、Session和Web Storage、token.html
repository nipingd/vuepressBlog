<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1.什么是Cookie与Session | niping</title>
    <meta name="description" content="欢迎来到我的博客">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.b8bd58f1.css" as="style"><link rel="preload" href="/assets/js/app.605f7bf6.js" as="script"><link rel="preload" href="/assets/js/47.61453b2a.js" as="script"><link rel="prefetch" href="/assets/js/10.1c38ddd1.js"><link rel="prefetch" href="/assets/js/100.4e218b8d.js"><link rel="prefetch" href="/assets/js/11.2fb27fcd.js"><link rel="prefetch" href="/assets/js/12.7f5d6c66.js"><link rel="prefetch" href="/assets/js/13.afd7e8cf.js"><link rel="prefetch" href="/assets/js/14.abdc9993.js"><link rel="prefetch" href="/assets/js/15.808a665e.js"><link rel="prefetch" href="/assets/js/16.71687d94.js"><link rel="prefetch" href="/assets/js/17.a75a6b7c.js"><link rel="prefetch" href="/assets/js/18.55a138b5.js"><link rel="prefetch" href="/assets/js/19.7a27f92f.js"><link rel="prefetch" href="/assets/js/2.a0853f16.js"><link rel="prefetch" href="/assets/js/20.c232c5eb.js"><link rel="prefetch" href="/assets/js/21.ff589d24.js"><link rel="prefetch" href="/assets/js/22.52926777.js"><link rel="prefetch" href="/assets/js/23.f88a6900.js"><link rel="prefetch" href="/assets/js/24.301d4b74.js"><link rel="prefetch" href="/assets/js/25.54e34988.js"><link rel="prefetch" href="/assets/js/26.3c9bb75a.js"><link rel="prefetch" href="/assets/js/27.5c786187.js"><link rel="prefetch" href="/assets/js/28.f48e3896.js"><link rel="prefetch" href="/assets/js/29.2412685e.js"><link rel="prefetch" href="/assets/js/3.3c1540bb.js"><link rel="prefetch" href="/assets/js/30.3a8e1ab3.js"><link rel="prefetch" href="/assets/js/31.49a8723f.js"><link rel="prefetch" href="/assets/js/32.412ca5b8.js"><link rel="prefetch" href="/assets/js/33.17345503.js"><link rel="prefetch" href="/assets/js/34.5b0993d9.js"><link rel="prefetch" href="/assets/js/35.cb08cfb6.js"><link rel="prefetch" href="/assets/js/36.332bc48c.js"><link rel="prefetch" href="/assets/js/37.dc2e2cd0.js"><link rel="prefetch" href="/assets/js/38.477a3394.js"><link rel="prefetch" href="/assets/js/39.375c8201.js"><link rel="prefetch" href="/assets/js/4.4aeed968.js"><link rel="prefetch" href="/assets/js/40.ee8401df.js"><link rel="prefetch" href="/assets/js/41.84b51588.js"><link rel="prefetch" href="/assets/js/42.b60471c1.js"><link rel="prefetch" href="/assets/js/43.7c481bf6.js"><link rel="prefetch" href="/assets/js/44.947cef77.js"><link rel="prefetch" href="/assets/js/45.72e01460.js"><link rel="prefetch" href="/assets/js/46.6d48dad8.js"><link rel="prefetch" href="/assets/js/48.f3020483.js"><link rel="prefetch" href="/assets/js/49.98b14a44.js"><link rel="prefetch" href="/assets/js/5.f1814b6e.js"><link rel="prefetch" href="/assets/js/50.a1adfd9d.js"><link rel="prefetch" href="/assets/js/51.482ccf2d.js"><link rel="prefetch" href="/assets/js/52.665c377d.js"><link rel="prefetch" href="/assets/js/53.b5e50b04.js"><link rel="prefetch" href="/assets/js/54.8c001290.js"><link rel="prefetch" href="/assets/js/55.b4c7cfae.js"><link rel="prefetch" href="/assets/js/56.aff2dc38.js"><link rel="prefetch" href="/assets/js/57.a37d5674.js"><link rel="prefetch" href="/assets/js/58.5e2f2f39.js"><link rel="prefetch" href="/assets/js/59.3349d38a.js"><link rel="prefetch" href="/assets/js/6.0b6e9473.js"><link rel="prefetch" href="/assets/js/60.d5a88cd5.js"><link rel="prefetch" href="/assets/js/61.d598aedc.js"><link rel="prefetch" href="/assets/js/62.816aed6d.js"><link rel="prefetch" href="/assets/js/63.5bc595dc.js"><link rel="prefetch" href="/assets/js/64.097b9bdb.js"><link rel="prefetch" href="/assets/js/65.a2fcf05f.js"><link rel="prefetch" href="/assets/js/66.fdca540b.js"><link rel="prefetch" href="/assets/js/67.0ff15c5a.js"><link rel="prefetch" href="/assets/js/68.d71f6942.js"><link rel="prefetch" href="/assets/js/69.ef5b0ea6.js"><link rel="prefetch" href="/assets/js/7.a4258f97.js"><link rel="prefetch" href="/assets/js/70.d218fe31.js"><link rel="prefetch" href="/assets/js/71.c82462ed.js"><link rel="prefetch" href="/assets/js/72.e5ae465e.js"><link rel="prefetch" href="/assets/js/73.9d503809.js"><link rel="prefetch" href="/assets/js/74.c3dd7d1d.js"><link rel="prefetch" href="/assets/js/75.3b49fa00.js"><link rel="prefetch" href="/assets/js/76.568de4ae.js"><link rel="prefetch" href="/assets/js/77.2a9e51c5.js"><link rel="prefetch" href="/assets/js/78.9741ed03.js"><link rel="prefetch" href="/assets/js/79.2186a60e.js"><link rel="prefetch" href="/assets/js/8.cabbb93f.js"><link rel="prefetch" href="/assets/js/80.39af3108.js"><link rel="prefetch" href="/assets/js/81.829c69b5.js"><link rel="prefetch" href="/assets/js/82.f08ca8d9.js"><link rel="prefetch" href="/assets/js/83.5d8682e8.js"><link rel="prefetch" href="/assets/js/84.a8d1e711.js"><link rel="prefetch" href="/assets/js/85.88998bdb.js"><link rel="prefetch" href="/assets/js/86.34f82ec6.js"><link rel="prefetch" href="/assets/js/87.c132588b.js"><link rel="prefetch" href="/assets/js/88.da412312.js"><link rel="prefetch" href="/assets/js/89.eccdb1dd.js"><link rel="prefetch" href="/assets/js/9.d899ed1a.js"><link rel="prefetch" href="/assets/js/90.c0e3e612.js"><link rel="prefetch" href="/assets/js/91.326d1cdb.js"><link rel="prefetch" href="/assets/js/92.73b34bc3.js"><link rel="prefetch" href="/assets/js/93.bd169111.js"><link rel="prefetch" href="/assets/js/94.77673974.js"><link rel="prefetch" href="/assets/js/95.c00bbaa6.js"><link rel="prefetch" href="/assets/js/96.efbfd5b1.js"><link rel="prefetch" href="/assets/js/97.5651ee1e.js"><link rel="prefetch" href="/assets/js/98.c1703e55.js"><link rel="prefetch" href="/assets/js/99.8896d4ac.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8bd58f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">niping</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/font/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/other/" class="nav-link">个人学习笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.instagram.com/nipingd/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  instagram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/nipingd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/font/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/other/" class="nav-link">个人学习笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.instagram.com/nipingd/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  instagram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/nipingd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>浏览器网络</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/font/浏览器网络/URL到页面呈现过程总结.html" class="sidebar-link">URL到页面呈现过程总结</a></li><li><a href="/font/浏览器网络/Web安全.html" class="sidebar-link">Web安全</a></li><li><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html" class="active sidebar-link">Cookie、Session和Web Storage、token</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_1-什么是cookie与session" class="sidebar-link">1.什么是Cookie与Session</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_2-两者的区别" class="sidebar-link">2.两者的区别</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_3-如何配合" class="sidebar-link">3.如何配合</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_4-禁止cookie后的正常运转" class="sidebar-link">4.禁止Cookie后的正常运转</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_5-分布式session问题" class="sidebar-link">5.分布式Session问题</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_6-跨域请求" class="sidebar-link">6.跨域请求</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_7-localstorage，sessionstorage和cookie的区别" class="sidebar-link">7.localStorage，sessionStorage和cookie的区别</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_8-cookie使用方法介绍" class="sidebar-link">8.cookie使用方法介绍</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_9-sessionstorage-和-localstorage用法" class="sidebar-link">9.SessionStorage 和  localStorage用法</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Cookie、Session和Web Storage、token.html#_10-token" class="sidebar-link">10.Token</a></li></ul></li><li><a href="/font/浏览器网络/跨域实现.html" class="sidebar-link">跨域实现</a></li><li><a href="/font/浏览器网络/CORS通信详解.html" class="sidebar-link">CORS通信详解</a></li><li><a href="/font/浏览器网络/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/font/浏览器网络/页面性能优化.html" class="sidebar-link">页面性能优化</a></li><li><a href="/font/浏览器网络/网络基础.html" class="sidebar-link">网络基础</a></li><li><a href="/font/浏览器网络/前端路由.html" class="sidebar-link">前端路由</a></li><li><a href="/font/浏览器网络/chrome调试技巧.html" class="sidebar-link">chrome调试技巧</a></li><li><a href="/font/浏览器网络/网络零散知识整理.html" class="sidebar-link">网络零散知识整理</a></li><li><a href="/font/浏览器网络/浏览器零散知识整理.html" class="sidebar-link">浏览器零散知识整理</a></li><li><a href="/font/浏览器网络/HTTP面试题.html" class="sidebar-link">HTTP面试题</a></li><li><a href="/font/浏览器网络/TCP面试题.html" class="sidebar-link">TCP面试题</a></li><li><a href="/font/浏览器网络/前端安全面试题.html" class="sidebar-link">前端安全面试题</a></li><li><a href="/font/浏览器网络/浏览器面试题.html" class="sidebar-link">浏览器面试题</a></li><li><a href="/font/浏览器网络/Web Workers.html" class="sidebar-link">Web Workers</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>webpack</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="_1-什么是cookie与session"><a href="#_1-什么是cookie与session" aria-hidden="true" class="header-anchor">#</a> 1.什么是Cookie与Session</h2> <p><strong>什么是 Cookie</strong></p> <p>HTTP Cookie（也叫 Web Cookie或浏览器 Cookie）是服务器发送到用户浏览器并保存在本地的一小块数据，它会在浏览器下次向同一服务器再发起请求时被携带并发送到服务器上。通常，它用于告知服务端两个请求是否来自同一浏览器，如保持用户的登录状态。Cookie 使基于无状态的 HTTP 协议记录稳定的状态信息成为了可能。</p> <p>Cookie 主要用于以下三个方面：</p> <ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul> <p><strong>什么是 Session</strong></p> <p>Session 代表着服务器和客户端一次会话的过程。Session 对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的 Web 页之间跳转时，存储在 Session 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当客户端关闭会话，或者 Session 超时失效时会话结束。</p> <h2 id="_2-两者的区别"><a href="#_2-两者的区别" aria-hidden="true" class="header-anchor">#</a> 2.两者的区别</h2> <p>Cookie 和 Session 有什么不同？</p> <ul><li>作用范围不同，Cookie 保存在客户端（浏览器），Session 保存在服务器端。</li> <li>存取方式的不同，Cookie 只能保存 字符串，Session 可以存任意数据类型，一般情况下我们可以在 Session 中保持一些常用变量信息，比如说 UserId 等。</li> <li>有效期不同，Cookie 可设置为长时间保持，比如我们经常使用的默认登录功能，Session 一般失效时间较短，客户端关闭或者 Session 超时都会失效。</li> <li>隐私策略不同，Cookie 存储在客户端，比较容易遭到不法获取，早期有人将用户的登录名和密码存储在 Cookie 中导致信息被窃取；Session 存储在服务端，安全性相对 Cookie 要好一些。</li> <li>存储大小不同， 单个 Cookie 保存的数据不能超过 4K，Session 可存储数据远高于 Cookie</li></ul> <h2 id="_3-如何配合"><a href="#_3-如何配合" aria-hidden="true" class="header-anchor">#</a> 3.如何配合</h2> <p>为什么需要 Cookie 和 Session，他们有什么关联？</p> <p>说起来为什么需要 Cookie ，这就需要从浏览器开始说起，我们都知道浏览器是没有状态的(HTTP 协议无状态)，这意味着浏览器并不知道是张三还是李四在和服务端打交道。这个时候就需要有一个机制来告诉服务端，本次操作用户是否登录，是哪个用户在执行的操作，那这套机制的实现就需要 Cookie 和 Session 的配合。</p> <p>那么 Cookie 和 Session 是如何配合的呢？我画了一张图大家可以先了解下。</p> <p><img src="/assets/img/1558268493580.d9021a9e.png" alt="1558268493580"></p> <p>用户第一次请求服务器的时候，服务器根据用户提交的相关信息，创建创建对应的 Session ，请求返回时将此 Session 的唯一标识信息 SessionID 返回给浏览器，浏览器接收到服务器返回的 SessionID 信息后，会将此信息存入到 Cookie 中，同时 Cookie 记录此 SessionID 属于哪个域名。</p> <p>当用户第二次访问服务器的时候，请求会自动判断此域名下是否存在 Cookie 信息，如果存在自动将 Cookie 信息也发送给服务端，服务端会从 Cookie 中获取 SessionID，再根据 SessionID 查找对应的 Session 信息，如果没有找到说明用户没有登录或者登录失效，如果找到 Session 证明用户已经登录可执行后面操作。</p> <p>根据以上流程可知，SessionID 是连接 Cookie 和 Session 的一道桥梁，大部分系统也是根据此原理来验证用户登录状态。</p> <h2 id="_4-禁止cookie后的正常运转"><a href="#_4-禁止cookie后的正常运转" aria-hidden="true" class="header-anchor">#</a> 4.禁止Cookie后的正常运转</h2> <p>既然服务端是根据 Cookie 中的信息判断用户是否登录，那么如果浏览器中禁止了 Cookie，如何保障整个机制的正常运转。</p> <p>第一种方案，每次请求中都携带一个 SessionID 的参数，也可以 Post 的方式提交，也可以在请求的地址后面拼接 <code>xxx?SessionID=123456...</code>。</p> <p>第二种方案，Token 机制。Token 机制多用于 App 客户端和服务器交互的模式，也可以用于 Web 端做用户状态管理。</p> <p>Token 的意思是“令牌”，是服务端生成的一串字符串，作为客户端进行请求的一个标识。Token 机制和 Cookie 和 Session 的使用机制比较类似。</p> <p>当用户第一次登录后，服务器根据提交的用户信息生成一个 Token，响应时将 Token 返回给客户端，以后客户端只需带上这个 Token 前来请求数据即可，无需再次登录验证。</p> <h2 id="_5-分布式session问题"><a href="#_5-分布式session问题" aria-hidden="true" class="header-anchor">#</a> 5.分布式Session问题</h2> <p>如何考虑分布式 Session 问题？</p> <p>在互联网公司为了可以支撑更大的流量，后端往往需要多台服务器共同来支撑前端用户请求，那如果用户在 A 服务器登录了，第二次请求跑到服务 B 就会出现登录失效问题。</p> <p>分布式 Session 一般会有以下几种解决方案：</p> <ul><li>Nginx ip_hash 策略，服务端使用 Nginx 代理，每个请求按访问 IP 的 hash 分配，这样来自同一 IP 固定访问一个后台服务器，避免了在服务器 A 创建 Session，第二次分发到服务器 B 的现象。</li> <li>Session 复制，任何一个服务器上的 Session 发生改变（增删改），该节点会把这个 Session 的所有内容序列化，然后广播给所有其它节点。</li> <li>共享 Session，服务端无状态话，将用户的 Session 等信息使用缓存中间件来统一管理，保障分发到每一个服务器的响应结果都一致。</li></ul> <p>建议采用第三种方案。</p> <h2 id="_6-跨域请求"><a href="#_6-跨域请求" aria-hidden="true" class="header-anchor">#</a> 6.跨域请求</h2> <p>如何解决跨域请求？Jsonp 跨域的原理是什么？</p> <p>说起跨域请求，必须要了解浏览器的同源策略，同源策略/SOP（Same origin policy）是一种约定，由 Netscape 公司 1995年引入浏览器，它是浏览器最核心也最基本的安全功能，如果缺少了同源策略，浏览器很容易受到 XSS、CSFR 等攻击。所谓同源是指&quot;协议+域名+端口&quot;三者相同，即便两个不同的域名指向同一个 ip 地址，也非同源。</p> <p>解决跨域请求的常用方法是：</p> <ul><li>通过代理来避免，比如使用 Nginx 在后端转发请求，避免了前端出现跨域的问题。</li> <li>通过 Jsonp 跨域</li> <li>其它跨域解决方案</li></ul> <p>重点谈一下 Jsonp 跨域原理。浏览器的同源策略把跨域请求都禁止了，但是页面中的 <code>&lt;script&gt;&lt;img&gt;&lt;iframe&gt;</code>标签是例外，不受同源策略限制。Jsonp 就是利用 <code>&lt;script&gt;</code> 标签跨域特性进行跨域数据访问。</p> <p>JSONP 的理念就是，与服务端约定好一个回调函数名，服务端接收到请求后，将返回一段 Javascript，在这段  Javascript 代码中调用了约定好的回调函数，并且将数据作为参数进行传递。当网页接收到这段 Javascript 代码后，就会执行这个回调函数，这时数据已经成功传输到客户端了。</p> <p>JSONP 的缺点是：它只支持 GET 请求，而不支持 POST 请求等其他类型的 HTTP 请求。</p> <p>作者：ityouknow</p> <p>链接：https://juejin.im/post/5cd9037ee51d456e5c5babca</p> <p>来源：掘金</p> <p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p> <h2 id="_7-localstorage，sessionstorage和cookie的区别"><a href="#_7-localstorage，sessionstorage和cookie的区别" aria-hidden="true" class="header-anchor">#</a> 7.localStorage，sessionStorage和cookie的区别</h2> <p><strong>共同点</strong>：都是保存在浏览器端、且同源的</p> <div class="tip custom-block"><p class="custom-block-title">数据存储方面</p> <ul><li><strong>cookie数据</strong>始终在同源的http请求中携带（即使不需要），即cookie在浏览器和服务器间来回传递。cookie数据还有路径（path）的概念，可以限制cookie只属于某个路径下</li> <li><strong>sessionStorage和localStorage</strong>不会自动把数据发送给服务器，仅在<strong>本地保存</strong>。</li></ul></div> <div class="tip custom-block"><p class="custom-block-title">存储数据大小</p> <ul><li>存储大小限制也不同，<strong>cookie数据</strong>不能超过4K，同时因为每次http请求都会携带cookie、所以cookie只适合保存很小的数据，如会话标识。</li> <li><strong>sessionStorage和localStorage</strong>虽然也有存储大小的限制，但比cookie大得多，可以达到5M或更大</li></ul></div> <div class="tip custom-block"><p class="custom-block-title">数据存储有效期</p> <ul><li><strong>sessionStorage</strong>：仅在当前浏览器窗口关闭之前有效；</li> <li><strong>localStorage</strong>：始终有效，窗口或浏览器关闭也一直保存，本地存储，因此用作持久数据；</li> <li><strong>cookie</strong>：只在设置的cookie过期时间之前有效，即使窗口关闭或浏览器关闭</li></ul></div> <div class="tip custom-block"><p class="custom-block-title">作用域不同</p> <ul><li><strong>sessionStorage</strong>不在不同的浏览器窗口中共享，即使是同一个页面；</li> <li><strong>localstorage</strong>在所有<code>同源窗口</code>中都是共享的；也就是说只要浏览器不关闭，数据仍然存在</li> <li><strong>cookie</strong>: 也是在所有<code>同源窗口</code>中都是共享的.也就是说只要浏览器不关闭，数据仍然存在</li></ul></div> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>Web Storage拥有setItem、getItem、removeItem、clear等方法，不像cookie需要自己封装setCookie、getCookie等方法</p></div> <table><thead><tr><th>特性</th> <th>cookie</th> <th>localStorage</th> <th>sessionStorage</th></tr></thead> <tbody><tr><td>由谁初始化</td> <td>客户端或服务器，服务器可以使用<code>Set-Cookie</code>请求头。</td> <td>客户端</td> <td>客户端</td></tr> <tr><td>数据的生命周期</td> <td>一般由服务器生成，可设置失效时间，如果在浏览器生成，默认是关闭浏览器之后失效</td> <td>永久保存，可清除</td> <td>仅在当前会话有效，关闭页面后清除</td></tr> <tr><td>存放数据大小</td> <td>4KB</td> <td>5MB</td> <td>5MB</td></tr> <tr><td>与服务器通信</td> <td>每次都会携带在HTTP头中，如果使用cookie保存过多数据会带来性能问题</td> <td>仅在客户端保存</td> <td>仅在客户端保存</td></tr> <tr><td>用途</td> <td>一般由服务器生成，用于标识用户身份</td> <td>用于浏览器缓存数据</td> <td>用于浏览器缓存数据</td></tr> <tr><td>访问权限</td> <td>任意窗口</td> <td>任意窗口</td> <td>当前页面窗口</td></tr></tbody></table> <h3 id="sessionstorage与页面js数据对象的区别"><a href="#sessionstorage与页面js数据对象的区别" aria-hidden="true" class="header-anchor">#</a> sessionStorage与页面js数据对象的区别</h3> <p>页面中一般的js对象的生存期仅在当前页面有效，因此刷新页面或转到另一页面这样的重新加载页面的情况，数据就不存在了()</p> <p>而sessionStorage只要同源的同窗口中，刷新页面或进入同源的不同页面，数据始终存在，也就是说只要浏览器不关闭，数据仍然存在()</p> <h2 id="_8-cookie使用方法介绍"><a href="#_8-cookie使用方法介绍" aria-hidden="true" class="header-anchor">#</a> 8.cookie使用方法介绍</h2> <h4 id="浏览器中的cookie"><a href="#浏览器中的cookie" aria-hidden="true" class="header-anchor">#</a> 浏览器中的Cookie</h4> <p>浏览器中的Cookie主要由以下几部分组成：</p> <ul><li>名称：Cookie唯一的名称，必须经过URL编码处理。（同名会出现覆盖的情况）</li> <li>值：必须经过URL编码处理。</li> <li>域（domain）：默认情况下cookie在当前域下有效，你也可以设置该值来确保对其子域是否有效。</li> <li>路径（path）：指定Cookie在哪些路径下有效，默认是当前路径下。</li> <li>失效时间（expires）：默认情况下，浏览器会话结束时会自动删除Cookie；也可以设置一个GMT格式的日期，指定具体的删除日期；如果设置的日期为以前的日期，那么Cookie会立即删除。</li> <li>安全标志（secure）：指定之后只允许Cookie发送给https协议。</li></ul> <p>浏览器在发送请求时，只会将名称与值添加到请求头的Cookie字段中，发送给服务端。</p> <p>浏览器提供了一个非常蹩脚的API来操作Cookie：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过上述方法可以对该Cookie进行写操作，每一次只能写入一条Cookie字符串：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">'a=1; secure; path=/'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过该方法还可以进行Cookie的读操作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>document<span class="token punctuation">.</span>cookie   <span class="token comment">// &quot;a=1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>由于上述方法操作Cookie非常的不直观，一般都会写一些函数来简化Cookie读取、设置和删除操作。</p> <p>对于Cookie的设置操作中，需要以下几点：</p> <p>对于名称和值进行URL编码处理，也就是采用JavaScript中的encodeURIComponent()方法； expires要求传入GMT格式的日期，需要处理为更易书写的方式，比如：设置秒数的方式； 注意只有的属性名的secure；</p> <p>每一段信息需要采用分号加空格。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">setCookie</span> <span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> attributes</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> document <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token keyword">return</span>  
<span class="token punctuation">}</span>  
    attributes <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>    
        path<span class="token punctuation">:</span> <span class="token string">'/'</span>  
    <span class="token punctuation">}</span><span class="token punctuation">,</span> attributes<span class="token punctuation">)</span>
  	<span class="token keyword">let</span> <span class="token punctuation">{</span> domain<span class="token punctuation">,</span> path<span class="token punctuation">,</span> expires<span class="token punctuation">,</span> secure <span class="token punctuation">}</span> <span class="token operator">=</span> attributes
 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> expires <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      expires <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> expires <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">}</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>expires <span class="token keyword">instanceof</span> <span class="token class-name">Date</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
        expires <span class="token operator">=</span> expires<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    
        expires <span class="token operator">=</span> <span class="token string">''</span>  
    <span class="token punctuation">}</span>
  	key <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>  
  	value <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  	<span class="token keyword">let</span> cookieStr <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>domain<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      cookieStr <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`; domain=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>  
  <span class="token punctuation">}</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      cookieStr <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`; path=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>  
  <span class="token punctuation">}</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>expires<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      cookieStr <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`; expires=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expires<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span>  
  <span class="token punctuation">}</span>
  	<span class="token keyword">if</span> <span class="token punctuation">(</span>secure<span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      cookieStr <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`; secure`</span></span>  
  <span class="token punctuation">}</span>
  	<span class="token keyword">return</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> cookieStr<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>Cookie的读操作需要注意的是将名称与值进行URL解码处理，也就是调用JavaScript中的decodeURIComponent()方法：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getCookie</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> document <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
	<span class="token keyword">return</span>  
<span class="token punctuation">}</span>  
<span class="token keyword">let</span> cookies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
<span class="token keyword">let</span> jar <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  
document<span class="token punctuation">.</span>cookie <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>cookies <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'; '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> max <span class="token operator">=</span> cookies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> max<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    
      <span class="token keyword">let</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> cookies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'='</span><span class="token punctuation">)</span>    
      key <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>    
      value <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>    
      jar<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value    
      <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">===</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>      
          <span class="token keyword">break</span>    
      <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> name <span class="token operator">?</span> jar<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">:</span> jar
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>最后一个清除的方法就更加简单了，只要将失效日期（expires）设置为过去的日期即可：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">removeCookie</span> <span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   
	<span class="token function">setCookie</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> expires<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> 
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>介绍Cookie基本操作的封装之后，还需要了解浏览器为了限制Cookie不会被恶意使用，规定了Cookie所占磁盘空间的大小以及每个域名下Cookie的个数。</p> <p>为了绕开单域名下Cookie个数的限制，开发人员还创造了一种称为subcookie的概念，这里就不在赘述了，可以参考【JavaScript高级程序设计第23章 p633】。</p> <h4 id="服务端的cookie"><a href="#服务端的cookie" aria-hidden="true" class="header-anchor">#</a> 服务端的Cookie</h4> <p>相比较浏览器端，服务端执行Cookie的写操作时，是将拼接好的Cookie字符串放入响应头的Set-Cookie字段中；执行Cookie的读操作时，则是解析HTTP请求头字段Cookie中的键值对。</p> <p>与浏览器最大的不同，在于服务端对于Cookie的安全性操碎了心</p> <p>signed</p> <p>当设置signed=true时，服务端会对该条Cookie字符串生成两个Set-Cookie响应头字段：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Set<span class="token operator">-</span>Cookie<span class="token punctuation">:</span> lastTime<span class="token operator">=</span><span class="token number">2019</span><span class="token operator">-</span><span class="token number">03</span><span class="token operator">-</span><span class="token number">05</span>T14<span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">05.543</span>Z<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> httponly
Set<span class="token operator">-</span>Cookie<span class="token punctuation">:</span> lastTime<span class="token punctuation">.</span>sig<span class="token operator">=</span>URXREOYTtMnGm0b7qCYFJ2Db400<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> httponly
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这里通过再发送一条以.sig为后缀的名称以及对值进行加密的Cookie，来验证该条Cookie是否在传输的过程中被篡改。</p> <p>httpOnly</p> <p>服务端Set-Cookie字段中新增httpOnly属性，当服务端在返回的Cookie信息中含有httpOnly字段时，开发者是不能通过JavaScript来操纵该条Cookie字符串的。</p> <p>这样做的好处主要在于面对XSS（Cross-site scripting）攻击时，黑客无法拿到设置httpOnly字段的Cookie信息。</p> <p>此时，你会发现localStorage相比较Cookie，在XSS攻击的防御上就略逊一筹了。 sameSite</p> <p>在介绍这个新属性之前，首先你需要明白：当用户从http://a.com发起http://b.com的请求也会携带上Cookie，而从http://a.com携带过来的Cookie称为第三方Cookie。</p> <p>虽然第三方Cookie有一些好处，但是给CSRF（Cross-site request forgrey）攻击的机会。</p> <p>为了从根源上解决CSRF攻击，sameSite属性便闪亮登场了，它的取值有以下几种：</p> <ul><li>strict：浏览器在任何跨域请求中都不会携带Cookie，这样可以有效的防御CSRF攻击，但是对于有多个子域名的网站采用主域名存储用户登录信息的场景，每个子域名都需要用户重新登录，造成用户体验非常的差。</li> <li>lax：相比较strict，它允许从三方网站跳转过来的时候使用Cookie。</li></ul> <p>为了方便大家理解sameSite的实际效果，可以看这个例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// a.com 服务端会在访问页面时返回如下</span>
Cookiecookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'aaaaa'</span><span class="token punctuation">)</span>
cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'bbbbb'</span><span class="token punctuation">)</span>
cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'cccccc'</span><span class="token punctuation">)</span>
<span class="token comment">// b.com 服务端会在访问页面时返回如下</span>
Cookiecookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> sameSite<span class="token punctuation">:</span> <span class="token string">'strict'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> sameSite<span class="token punctuation">:</span> <span class="token string">'lax'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如何现在用户在a.com中点击链接跳转到b.com，它的请求头是这样的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Request Headers 
Cookie<span class="token punctuation">:</span> bar<span class="token operator">=</span>b<span class="token punctuation">;</span> baz<span class="token operator">=</span>c
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="_9-sessionstorage-和-localstorage用法"><a href="#_9-sessionstorage-和-localstorage用法" aria-hidden="true" class="header-anchor">#</a> 9.SessionStorage 和  localStorage用法</h2> <p>H5对于web storage的支持很友好，使用方法很简单</p> <ul><li><strong>setItem()</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>keyName<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 将value存储到key字段中</span>
<span class="token comment">//或者</span>
sessionStorage<span class="token punctuation">.</span>keyName<span class="token operator">=</span><span class="token string">'value'</span><span class="token punctuation">;</span>
eg：sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;thomas&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>keyName<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//获取指定key的本地存储的值</span>
<span class="token comment">//或者</span>
<span class="token keyword">var</span> keyName<span class="token operator">=</span>localStorage<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
eg<span class="token punctuation">:</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>下面我只列举sessionStorage方法。</p> <blockquote><p>其他的方法基本同上，只是将前缀sessionStorage改成localStorage即可</p></blockquote> <ul><li><strong>getItem()</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>keyName<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//获取指定key的本地存储的值</span>
<span class="token comment">//或者</span>
<span class="token keyword">var</span> keyName<span class="token operator">=</span>sessionStorage<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
eg<span class="token punctuation">:</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><strong>removeItem()</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sessionStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span>keyName<span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// 删除指定ke的本地存储的值</span>
eg<span class="token punctuation">:</span> sesisonStorage<span class="token punctuation">.</span><span class="token function">removeItem</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>clear()</strong></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>sessionStorage<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token comment">//清除所有localStorage数据</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>key(index)</strong>：获得 index位置处的值的名字</li></ul> <p>作者：thomaszhou</p> <p>链接：https://juejin.im/post/5ad5b9116fb9a028e014fb19</p> <p>来源：掘金</p> <p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p> <p>以下taken内容来自：https://www.cnblogs.com/moyand/p/9047978.html</p> <h2 id="_10-token"><a href="#_10-token" aria-hidden="true" class="header-anchor">#</a> 10.Token</h2> <p>在介绍基于Token的身份验证的原理与优势之前，不妨先看看之前的认证都是怎么做的。</p> <h4 id="基于服务器的验证"><a href="#基于服务器的验证" aria-hidden="true" class="header-anchor">#</a> <strong>基于服务器的验证</strong></h4> <p>我们都是知道HTTP协议是无状态的，这种无状态意味着程序需要验证每一次请求，从而辨别客户端的身份。</p> <p>在这之前，程序都是通过在服务端存储的登录信息来辨别请求的。这种方式一般都是通过存储Session来完成。</p> <p>随着Web，应用程序，已经移动端的兴起，这种验证的方式逐渐暴露出了问题。尤其是在可扩展性方面。</p> <div class="tip custom-block"><p class="custom-block-title">基于服务器验证方式暴露的一些问题</p> <ol><li>**Seesion：**每次认证用户发起请求时，服务器需要去创建一个记录来存储信息。当越来越多的用户发请求时，内存的开销也会不断增加。</li> <li>**可扩展性：**在服务端的内存中使用Seesion存储登录信息，伴随而来的是可扩展性问题。</li> <li>**CORS(跨域资源共享)：**当我们需要让数据跨多台移动设备上使用时，跨域资源的共享会是一个让人头疼的问题。在使用Ajax抓取另一个域的资源，就可以会出现禁止请求的情况。</li> <li>**CSRF(跨站请求伪造)：**用户在访问银行网站时，他们很容易受到跨站请求伪造的攻击，并且能够被利用其访问其他的网站。</li></ol></div> <p>在这些问题中，可扩展行是最突出的。因此我们有必要去寻求一种更有行之有效的方法。</p> <h4 id="基于token的验证原理"><a href="#基于token的验证原理" aria-hidden="true" class="header-anchor">#</a> <strong>基于Token的验证原理</strong></h4> <p>基于Token的身份验证是无状态的，我们不将用户信息存在服务器或Session中。</p> <p>这种概念解决了在服务端存储信息时的许多问题</p> <blockquote><p>NoSession意味着你的程序可以根据需要去增减机器，而不用去担心用户是否登录。</p></blockquote> <div class="tip custom-block"><p class="custom-block-title">基于Token的身份验证的过程如下:</p> <ol><li>用户通过用户名和密码发送请求。</li> <li>程序验证。</li> <li>程序返回一个签名的token 给客户端。</li> <li>客户端储存token,并且每次用于每次发送请求。</li> <li>服务端验证token并返回数据。</li></ol></div> <p>每一次请求都需要token。token应该在HTTP的头部发送从而保证了Http请求无状态。我们同样通过设置服务器属性Access-Control-Allow-Origin:* ，让服务器能接受到来自所有域的请求。</p> <p>需要主要的是，在ACAO头部标明(designating)*时，不得带有像HTTP认证，客户端SSL证书和cookies的证书。</p> <p>实现思路：</p> <p><img src="/assets/img/1565531954394.f2e7c6fc.png" alt="1565531954394"></p> <div class="tip custom-block"><p class="custom-block-title">思路</p> <ol><li>用户登录校验，校验成功后就返回Token给客户端。</li> <li>客户端收到数据后保存在客户端</li> <li>客户端每次访问API是携带Token到服务器端。</li> <li>服务器端采用filter过滤器校验。校验成功则返回请求数据，校验失败则返回错误码</li></ol></div> <p>当我们在程序中认证了信息并取得token之后，我们便能通过这个Token做许多的事情。</p> <p>我们甚至能基于创建一个基于权限的token传给第三方应用程序，这些第三方程序能够获取到我们的数据（当然只有在我们允许的特定的token）</p> <h3 id="tokens的优势"><a href="#tokens的优势" aria-hidden="true" class="header-anchor">#</a> <strong>Tokens的优势</strong></h3> <p><strong>无状态、可扩展</strong></p> <p>在客户端存储的Tokens是无状态的，并且能够被扩展。基于这种无状态和不存储Session信息，负载负载均衡器能够将用户信息从一个服务传到其他服务器上。</p> <p>如果我们将已验证的用户的信息保存在Session中，则每次请求都需要用户向已验证的服务器发送验证信息(称为Session亲和性)。用户量大时，可能会造成一些拥堵。</p> <p>但是不要着急。使用tokens之后这些问题都迎刃而解，因为tokens自己hold住了用户的验证信息。</p> <p><strong>安全性</strong></p> <p>请求中发送token而不再是发送cookie能够防止CSRF(跨站请求伪造)。即使在客户端使用cookie存储token，cookie也仅仅是一个存储机制而不是用于认证。不将信息存储在Session中，让我们少了对session操作。</p> <p>token是有时效的，一段时间之后用户需要重新验证。我们也不一定需要等到token自动失效，<strong>token有撤回的操作，通过token revocataion可以使一个特定的token或是一组有相同认证的token无效。</strong></p> <p><strong>可扩展性</strong></p> <p>Tokens能够创建与其它程序共享权限的程序。例如，能将一个随便的社交帐号和自己的大号(Fackbook或是Twitter)联系起来。当通过服务登录Twitter(我们将这个过程Buffer)时，我们可以将这些Buffer附到Twitter的数据流上(we are allowing Buffer to post to our Twitter stream)。</p> <p>使用tokens时，可以提供可选的权限给第三方应用程序。当用户想让另一个应用程序访问它们的数据，我们可以通过建立自己的API，得出特殊权限的tokens。</p> <p><strong>多平台跨域</strong></p> <p>我们提前先来谈论一下CORS(跨域资源共享)，对应用程序和服务进行扩展的时候，需要介入各种各种的设备和应用程序。</p> <p>只要用户有一个通过了验证的token，数据和资源就能够在任何域上被请求到。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Access<span class="token operator">-</span>Control<span class="token operator">-</span>Allow<span class="token operator">-</span>Origin<span class="token punctuation">:</span> <span class="token operator">*</span>      
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>基于标准创建token的时候，你可以设定一些选项。我们在后续的文章中会进行更加详尽的描述，但是标准的用法会在JSON Web Tokens体现。</p> <p>最近的程序和文档是供给JSON Web Tokens的。它支持众多的语言。这意味在未来的使用中你可以真正的转换你的认证机制。</p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新时间: </span> <span class="time">9/23/2019, 12:19:35 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.605f7bf6.js" defer></script><script src="/assets/js/47.61453b2a.js" defer></script>
  </body>
</html>
